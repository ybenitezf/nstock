{{if 'in_all_items' in globals().keys():}}
  {{remove_item = False}}
{{else:}}
  {{remove_item = True}}
{{pass}}

{{contentType = application.getContentType(item.item_type)}}

{{if contentType is not None:}}
  <div id="item-{{=item.id}}" class="media item-preview">
    <div class="media-body text-preview">
        <div class="pull-right">
          {{if session.dashboard:}}
            {{dash = db.dashboard(session.dashboard)}}
            <button id="toggle{{=item.id}}" class="btn btn-default {{='active' if is_in_board(item, dash) else ''}}" title="{{=T('Toogle pin to dashboard')}}">
              <i class="fa fa-map-pin"></i>
            </button>

            <script>
            $(function() {

              $('#toggle{{=item.id}}').click(function(e) {
                e.stopPropagation();
                Pace.start();
                web2py_component("{{=URL('dashboard', 'toogle_pin.load', vars=dict(remove_item=remove_item), args=[dash.id, item.id])}}", target='hiddethis');
                $( this ).toggleClass( 'active' );
                Pace.stop();
              });

            });
            </script>

          {{pass}}

          <!-- Item menu -->
          <div class="btn-group">
            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              <li class="fa fa-bars"></li>
            </button>
            <ul class="dropdown-menu pull-right">
              {{if application.isOwner(item.unique_id):}}
                <li>
                  <a href="{{=application.getItemURL(item.unique_id)}}">
                    <i class="fa fa-edit"></i>
                    {{=T("Edit content")}}
                  </a>
                </li>
                <li>
                  <a id="itemDetails{{=item.id}}" href="#">
                      <i class="fa fa-cog"></i> {{=T('Details')}}
                  </a>
                  <script type="text/javascript">
                    $('#itemDetails{{=item.id}}').click(function (e) {
                      $('#metaModal').modal('show');
                      web2py_component("{{=URL('item', 'meta.load', args=[item.unique_id])}}","metaModalBody");
                    });
                  </script>
                </li>
              {{pass}}
              <li>
                <!-- View item comments -->
                <a href="#" data-toggle="modal" data-target="#cmtModal{{=item.id}}">
                  <i class="fa fa-comments"></i> {{=T("Comments")}}
                </a>
              </li>
            </ul>
          </div>
        </div>
      <p><strong>{{=T("Headline")}}</strong>: {{=item.headline}}</p>
      <p><strong>{{=T("Slugline")}}</strong>: {{=item.slugline}}</p>
      <p>
        <strong>{{=T("Keywords")}}</strong>:
        {{for k in item.keywords:}}
          <span class="badge">{{=k}}</span>
        {{pass}}
      </p>
      <p><strong>{{=T("Genre")}}</strong>: {{=item.genre}}</p>
      {{=contentType.preview(item)}}
      {{author = db.auth_user(item.created_by)}}
      <p>
        <strong class="small text-muted">{{=author.first_name}} {{=author.last_name}}</strong>
        <span class="small text-muted">
          --
          {{=item.created_on}}
        </span>
      </p>

      <div class="pull-right">
        {{=plugin_comment_short(item.unique_id)}}
      </div>
    </div>
  </div>
{{pass}}
